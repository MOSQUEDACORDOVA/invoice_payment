<style>
    .collapse {
        display: :none !important;
    }
</style>
{{#if msg}}
<label id="msgs" hidden>{{msg}}</label>
{{/if}}
<!-- BEGIN: Content-->
<div class="app-content content ">
    <div class="content-overlay"></div>
    <div class="header-navbar-shadow"></div>
    <div class="content-wrapper container-xxl p-0">
        <div class="content-header row">
        </div>
        <div class="content-body">
            {{#if activeBanner}}
            <div class="alert alert-primary alert-dismissible fade show"
                style="background-color: {{banner.colorBg}} !important;" role="alert">
                <div class="alert-body" style="color: {{banner.colorText}} !important;">
                    {{banner.valueSett}}
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {{/if}}
            <section class="invoice-preview-wrapper">
                <div class="row invoice-preview">

                    <!-- payment methods -->
                    <div class="card">
                        <div class="card-header border-bottom">
                            <h4 class="card-title">Payment Methods</h4>
                        </div>
                        <div class="card-body my-1 py-25">
                            <div class="row gx-4">
                                <div class="col-12">
                                    <div class="d-none form-check form-check-inline mb-1 ">
                                        <input name="collapsible-payment" class="form-check-input" type="radio"
                                            id="CCCheck" checked />
                                        <label class="form-check-label" for="CCCheck">Credit/Debit/ATM
                                            Card</label>
                                    </div>
                                    <div class="form-check form-check-inline mb-1 ">
                                        <input name="collapsible-payment" class="form-check-input" type="radio" value=""
                                            id="ACHBankCheck" checked />
                                        <label class="form-check-label" for="ACHBankCheck">ACH Bank</label>
                                    </div>
                                </div>
                                <div class="col-12  collapse" id="CCOpt">
                                    <div class="col-md-6 me-1">
                                        <form id="creditCardForm" class="row gx-2 gy-1 validate-form mt-1" method="post"
                                            action="/add_method_pay">
                                            <input type="text" name="typeM" id="typeM" value="CC" hidden>
                                            <div class="col-8 mt-0">
                                                <label class="form-label" for="addCardNumber">Card Number</label>
                                                <div class="input-group input-group-merge">
                                                    <input id="addCardNumber" name="cardNumber"
                                                        class="form-control add-credit-card-mask" type="number"
                                                        placeholder="5637 8172 1290 7898" aria-describedby="addCard2"
                                                        data-msg="Please enter your credit card number" required
                                                        maxlength="16" />
                                                    <span class="input-group-text cursor-pointer p-25" id="addCard2">
                                                        <span class="add-card-type"></span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-4 mt-0">
                                                <label class="form-label" for="addCardNumber">Card Nick Name</label>
                                                <div class="input-group input-group-merge">
                                                    <input id="addcardNickName" name="cardNickName"
                                                        class="form-control add-credit-card-mask" type="text"
                                                        placeholder="Please enter your credit card nickname"
                                                        aria-describedby="addCard2"
                                                        data-msg="Please enter your credit card nickname" required
                                                        maxlength="16" />
                                                    <span class="input-group-text cursor-pointer p-25" id="addCard2">
                                                        <span class="add-card-type"></span>
                                                    </span>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label" for="addCardName">Name On Card</label>
                                                <input type="text" id="addCardName" name="cardName" class="form-control"
                                                    placeholder="Santo Riboli" required />
                                            </div>

                                            <div class="col-6 col-md-3">
                                                <label class="form-label" for="addCardExpiryDate">Exp. Date</label>
                                                <input type="text" id="addCardExpiryDate" name="addCardExpiryDate"
                                                    class="form-control add-expiry-date-mask" placeholder="MM/YY"
                                                    required maxlength="5" />
                                            </div>

                                            <div class="col-6 col-md-3">
                                                <label class="form-label" for="addCardCvv">CVV</label>
                                                <input type="password" id="addCardCvv" name="cvv"
                                                    class="form-control add-cvv-code-mask" maxlength="4"
                                                    placeholder="cvv" required />
                                            </div>
                                            <div class="col-md-9">
                                                <label class="form-label" for="addCardName">Address</label>
                                                <input type="text" id="addressCard" name="addressCard"
                                                    class="form-control" placeholder="Address" />
                                            </div>

                                            <div class="col-6 col-md-3">
                                                <label class="form-label" for="addCardExpiryDate">ZIP</label>
                                                <input type="text" id="zipCode" name="zipCode" class="form-control"
                                                    placeholder="ZIP Code" minlength="5" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label" for="stateO">State</label>
                                                <select class="form-control" id="stateO" name="state">
                                                    <optgroup label="US Insides Territories">
                                                        <option value="AL">Alabama</option>
                                                        <option value="AK">Alaska</option>
                                                        <option value="AZ">Arizona</option>
                                                        <option value="AR">Arkansas</option>
                                                        <option value="CA">California</option>
                                                        <option value="CO">Colorado</option>
                                                        <option value="CT">Connecticut</option>
                                                        <option value="DE">Delaware</option>
                                                        <option value="DC">District Of Columbia</option>
                                                        <option value="FL">Florida</option>
                                                        <option value="GA">Georgia</option>
                                                        <option value="HI">Hawaii</option>
                                                        <option value="ID">Idaho</option>
                                                        <option value="IL">Illinois</option>
                                                        <option value="IN">Indiana</option>
                                                        <option value="IA">Iowa</option>
                                                        <option value="KS">Kansas</option>
                                                        <option value="KY">Kentucky</option>
                                                        <option value="LA">Louisiana</option>
                                                        <option value="ME">Maine</option>
                                                        <option value="MD">Maryland</option>
                                                        <option value="MA">Massachusetts</option>
                                                        <option value="MI">Michigan</option>
                                                        <option value="MN">Minnesota</option>
                                                        <option value="MS">Mississippi</option>
                                                        <option value="MO">Missouri</option>
                                                        <option value="MT">Montana</option>
                                                        <option value="NE">Nebraska</option>
                                                        <option value="NV">Nevada</option>
                                                        <option value="NH">New Hampshire</option>
                                                        <option value="NJ">New Jersey</option>
                                                        <option value="NM">New Mexico</option>
                                                        <option value="NY">New York</option>
                                                        <option value="NC">North Carolina</option>
                                                        <option value="ND">North Dakota</option>
                                                        <option value="OH">Ohio</option>
                                                        <option value="OK">Oklahoma</option>
                                                        <option value="OR">Oregon</option>
                                                        <option value="PA">Pennsylvania</option>
                                                        <option value="RI">Rhode Island</option>
                                                        <option value="SC">South Carolina</option>
                                                        <option value="SD">South Dakota</option>
                                                        <option value="TN">Tennessee</option>
                                                        <option value="TX">Texas</option>
                                                        <option value="UT">Utah</option>
                                                        <option value="VT">Vermont</option>
                                                        <option value="VA">Virginia</option>
                                                        <option value="WA">Washington</option>
                                                        <option value="WV">West Virginia</option>
                                                        <option value="WI">Wisconsin</option>
                                                        <option value="WY">Wyoming</option>
                                                    </optgroup>
                                                    <optgroup label="US Outlying Territories">
                                                        <option value="AS">American Samoa</option>
                                                        <option value="GU">Guam</option>
                                                        <option value="MP">Northern Mariana Islands</option>
                                                        <option value="PR">Puerto Rico</option>
                                                        <option value="UM">United States Minor Outlying Islands</option>
                                                        <option value="VI">Virgin Islands</option>
                                                    </optgroup>

                                                </select>
                                            </div>

                                            <div class="col-md-6">
                                                <label class="form-label" for="cityO">City</label>
                                                <input type="text" id="cityO" name="city" class="form-control"
                                                    placeholder="City" />
                                            </div>
                                            <div class="col-12 mt-2 pt-1">
                                                <button type="submit" class="btn btn-primary me-1">Save Changes</button>
                                                <button type="reset" class="btn btn-outline-secondary">Discard</button>
                                            </div>
                                            <div></div>
                                            <input type="hidden" />
                                        </form>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="fw-bolder mb-2">My Cards</h6>
                                        <div class="added-cards">
                                            {{#each CCMethod as |card i|}}
                                            <div class="cardMaster rounded border p-2 mb-1">
                                                <div class="d-flex justify-content-between flex-sm-row flex-column">
                                                    <div class="card-information">
                                                        <img class="mb-1 img-fluid"
                                                            src="../../app-assets/images/icons/payments/{{#GetCardType CARDNO}}{{/GetCardType}}.png"
                                                            alt="Mastercard" />
                                                        <div class="d-flex align-items-center mb-50">
                                                            <h6 class="mb-0">{{#decryptData NAME}}{{/decryptData}}</h6>
                                                            {{#primary_payment PAYID}}{{/primary_payment}}
                                                        </div>
                                                        <span class="card-number">{{#cardHide
                                                            CARDNO}}{{/cardHide}}</span>
                                                    </div>
                                                    <div class="d-flex flex-column text-start text-lg-end">
                                                        <div class="d-flex order-sm-0 order-1 mt-1 mt-sm-0">
                                                            <button
                                                                class="btn btn-outline-primary me-75 edit_credit_card"
                                                                data-name="{{#decryptData NAME}}{{/decryptData}}"
                                                                data-number="{{#decryptData CARDNO}}{{/decryptData}}"
                                                                data-exp="{{#decryptData EXPDAT}}{{/decryptData}}"
                                                                data-id="{{PAYID}}"
                                                                data-zip="{{#decryptData ZIP}}{{/decryptData}}"
                                                                data-address="{{ADDLIG1}}"
                                                                data-cvv="{{#decryptData CVC}}{{/decryptData}}"
                                                                data-state="{{SAT}}" data-city="{{CTY}}"
                                                                data-cardname="{{CARDNAME}}">
                                                                Edit
                                                            </button>
                                                            <a class="btn btn-outline-secondary"
                                                                href="/delete_payM/{{PAYID}}">Delete</a>
                                                        </div>
                                                        <span class="mt-2">Card expires at {{#decryptData
                                                            EXPDAT}}{{/decryptData}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            {{/each}}
                                        </div>
                                    </div>

                                </div>
                                <div class="col-12 d-flex" id="bankACH">
                                    <div class="col-md-6 me-1">
                                        <form id="formBankOptions" class="row gx-2 gy-1 validate-form" method="post"
                                            action="/add_method_pay">
                                            <input type="text" name="typeM" id="typeM" value="ACH" hidden>
                                            <div class="col-6 mt-0">
                                                <label class="form-label" for="legalNameAccount">Legal Name on
                                                    Account</label>
                                                <input id="legalNameAccount" name="legalNameAccount"
                                                    class="form-control add-credit-card-mask" type="text"
                                                    placeholder="Legal Name on Account" aria-describedby="addCard2"
                                                    data-msg="Please enter your Legal Name on Account" required />
                                            </div>
                                            <div class="col-6 mt-0">
                                                <label class="form-label" for="addCardNumber">Nick Name</label>
                                                <input id="payName" name="payName"
                                                    class="form-control add-credit-card-mask" type="text"
                                                    placeholder="Nick name" aria-describedby="addCard2"
                                                    data-msg="Please enter your Nick NAme" required />
                                            </div>
                                            <div class="col-6 mt-0">
                                                <label class="form-label" for="addCardNumber">ABA routing number</label>
                                                <input id="bank_id" name="bank_id"
                                                    class="form-control add-credit-card-mask" type="text"
                                                    placeholder="ABA routing number" aria-describedby="addCard2"
                                                    data-msg="Please enter your ABA routing number" required value="" />
                                            </div>
                                            <div class="col-6 mt-0">
                                                <label class="form-label" for="addCardNumber">Bank Account
                                                    Number</label>
                                                <input id="bank_account_number" name="bank_account_number"
                                                    class="form-control add-credit-card-mask" type="text"
                                                    placeholder="5637817212907898" aria-describedby="addCard2"
                                                    data-msg="Please enter your Bank Account Number" required
                                                    maxlength="34" value="" />
                                            </div>
                                            <div class="col-12 mt-2 pt-1">
                                                <button type="submit" class="btn btn-primary me-1">Save Changes</button>
                                                <button type="reset" class="btn btn-outline-secondary">Discard</button>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="fw-bolder mb-2">My Banks</h6>
                                        <div class="added-cards">
                                            {{#each ACHMethod as |bank i|}}
                                            <div class="cardMaster rounded border p-2 mb-1">
                                                <div class="d-flex justify-content-between flex-sm-row flex-column">
                                                    <div class="card-information">
                                                        {{!-- <img class="mb-1 img-fluid"
                                                            src="../../app-assets/images/icons/payments/{{#GetCardType CARDNO}}{{/GetCardType}}.png"
                                                            alt="Mastercard" /> --}}
                                                        <div class="d-flex align-items-center mb-50">
                                                            <h6 class="mb-0">{{#decryptData PAYNAME}}{{/decryptData}}
                                                            </h6>
                                                            {{!-- {{#virifiedACH verify}}{{/virifiedACH}} --}}
                                                            {{#if VERIFIED}}<span class="badge badge-light-success ms-50">Verified</span>{{else}}<span class="badge badge-light-warning ms-50">Not Verified</span>{{/if}}
                                                        </div>
                                                        <span class="card-number">{{#cardHide
                                                            BANKACCT}}{{/cardHide}}</span>
                                                    </div>
                                                    <div class="d-flex flex-column text-start text-lg-end">
                                                        <div class="d-flex order-sm-0 order-1 mt-1 mt-sm-0">
                                                            <button class="btn btn-outline-primary me-75 edit_ACH"
                                                                data-bankacct="{{#decryptData BANKACCT}}{{/decryptData}}"
                                                                data-bankrout="{{#decryptData BANKROUT}}{{/decryptData}}"
                                                                data-name="{{#decryptData PAYNAME}}{{/decryptData}}"
                                                                data-legalname="{{#decryptData NAME}}{{/decryptData}}"
                                                                data-id="{{PAYID}}">
                                                                Edit
                                                            </button>
                                                            <a class="btn btn-outline-secondary me-75"
                                                                onclick="deleteACH('{{PAYID}}','{{$uuid}}')" href="#">Delete</a>
                                                            {{!-- {{#virifiedACHBtn verify PAYID}}{{/virifiedACHBtn}} --}}
                                                            {{#if VERIFIED}}<a class="btn btn-outline-success verified">Verified</a>{{else}}<a class="btn btn-outline-info" onclick ="verifyPM('{{PAYID}}')" >Verify</a>{{/if}}

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {{/each}}
                                        </div>
                                    </div>

                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- / payment methods -->

                </div>
            </section>


        </div>
    </div>
</div>
<!-- END: Content-->
<script src="../../../app-assets/vendors/js/forms/validation/jquery.validate.min.js"></script>
<script>

    $('#ACHBankCheck').on('change', (e) => {
        /**show the different card form */
        $('#CCOpt').addClass('collapse')
        $('#CCOpt').removeClass('d-flex')
        $('#bankACH').removeClass('collapse')
        $('#bankACH').addClass('d-flex')
    })
    $('#CCCheck').on('change', (e) => {
        /**show the different card form */

        $('#bankACH').addClass('collapse')
        $('#bankACH').removeClass('d-flex')
        $('#CCOpt').removeClass('collapse')
        $('#CCOpt').addClass('d-flex')
    })

    /** JQUERY TO PUT EDIT CARD INFO */
    $('.edit_credit_card').on('click', (e) => {
        //GETT VALUES FROM DATASET
        let card_number = e.currentTarget.dataset['number'];
        let exp = e.currentTarget.dataset['exp']
        let name = e.currentTarget.dataset['name']
        let id = e.currentTarget.dataset['id']
        let zip = e.currentTarget.dataset['zip']
        let address = e.currentTarget.dataset['address']
        let cvv = e.currentTarget.dataset['cvv'],
            city = e.currentTarget.dataset['city'],
            cardname = e.currentTarget.dataset['cardname'],
            state = e.currentTarget.dataset['state'];

        $('#addCardNumber').val(card_number)
        $('#addCardName').val(name)
        $('#addCardExpiryDate').val(exp)
        $('#addressCard').val(address)
        $('#zipCode').val(zip)
        $('#addCardCvv').val(cvv)
        $('#cityO').val(city)
        $('#addcardNickName').val(cardname)
        if ($("#stateO option[value='" + state + "']").length == 0) {
            console.log("option doesn't exist!");
        } else {
            console.log("option exist!");
            $("#stateO option[value='" + state + "']").attr("selected", true);
        }

        //GHANGE THE FORM ACTION TO EDIT METHOD
        $('#creditCardForm').removeAttr('action')
        $('#creditCardForm').attr('action', '/edit_apy_method')
        //IF EXIST PREVIOUS PAYS ID INFO TO EDIT, REMOVE
        if ($('#pay_id')) {
            $('#pay_id').remove()
        }
        // CREATE THE INPUT WHIT ID TO EDIT
        var IDPay = $(`<input type=\"text\" value="${id}" id="pay_id" name="payID" class="d-none"/>`);
        $('#creditCardForm').append(IDPay)
    })

    //JQUERY TO MASK EXP DATE
    $('#addCardExpiryDate').on('keyup', (e) => {
        let value = e.target.value
        if (value.length == 2) {
            value += '/'
        }
        $('#addCardExpiryDate').val(value)
    })
    /** JQUERY TO PUT EDIT CARD INFO */
    $('.edit_ACH').on('click', (e) => {
        //GETT VALUES FROM DATASET
        let bankacct = e.currentTarget.dataset['bankacct'],
            bankrout = e.currentTarget.dataset['bankrout'],
            name = e.currentTarget.dataset['name'],
            legalname = e.currentTarget.dataset['legalname'],
            id = e.currentTarget.dataset['id'];

        $('#payName').val(name)
        $('#legalNameAccount').val(legalname)
        $('#bank_id').val(bankrout)
        $('#bank_account_number').val(bankacct)

        //$('#payName').attr('readonly')
        $('#legalNameAccount').attr('readonly', true)
        $('#bank_id').attr('readonly', true)
        $('#bank_account_number').attr('readonly', true)


        //GHANGE THE FORM ACTION TO EDIT METHOD
        $('#formBankOptions').removeAttr('action')
        $('#formBankOptions').attr('action', '/edit_apy_method')
        //IF EXIST PREVIOUS PAYS ID INFO TO EDIT, REMOVE
        if ($('#pay_id')) {
            $('#pay_id').remove()
        }
        // CREATE THE INPUT WHIT ID TO EDIT
        var IDPay = $(`<input type=\"text\" value="${id}" id="pay_id" name="payID" class="d-none"/>`);
        $('#formBankOptions').append(IDPay)
    })

    $('button[type=reset]').on('click',()=>{
        $('#legalNameAccount').attr('readonly', false)
        $('#bank_id').attr('readonly', false)
        $('#bank_account_number').attr('readonly', false)
    })
    $('.verified').on('click', (e) => {
        //GETT VALUES FROM DATASET
        swal.fire('Warning', 'Your account was previously verified', 'warning')
    })


    if ($('#formBankOptions').length) {
        $('#formBankOptions').validate({
            errorClass: 'error',
            rules: {
                'legalNameAccount': {
                    required: true
                },
                'payName': {
                    required: true
                },
                'bank_id': {
                    required: true,
                    // minlength: 9,
                    maxlength: 9

                },
                'bank_account_number': {
                    required: true
                }
            },
            messages: {
                'bank_id': {
                    minlength: jQuery.validator.format("At least {0} characters required!")
                }
            }
        });

        $('#formBankOptions').on('submit', function (e) {
            var isValid = $('#formBankOptions').valid();

            e.preventDefault();

            if ($('#bank_id').val().length < 9) {
                console.log($('#bank_id').val().length)
                let bank_id = $('#bank_id').val()
                bank_id = bank_id.padStart(9, "0");
                $('#bank_id').val(bank_id)
            }

            Swal.fire({
                title: `You are attempting to add a new ACH Bank account to your account. `,
        html: `Please read the terms and conditions below:
        <br><p style= "text-align: left">1) You are either the bank account owner or authorized on behalf of the owner to use this bank account to process payments <br>
        2) You have access to the bank account below to verify the two validation transactions that will be sent to this bank account.<br>
        3) You understand that the validation transactions will be both debited and credited from this bank account.<br>
        
        By pressing confirm below, you are confirming the above transactions are true. To proceed, press confirm. Otherwise, press cancel.</p>`,
        icon: 'info',
        showCancelButton: true,
        confirmButtonColor: '#007EA8',
        cancelButtonColor: '#C24B63',
        confirmButtonText: 'Confirm',
        cancelButtonText: 'Cancel',
            }).then((result) => {

                if (result.isConfirmed) {
                    if (isValid) {

                        this.submit()

                    }
                }
            });



        });
    }


    function deleteACH(PAYID, XIUUD) {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = `/delete_payM/${PAYID}/${XIUUD}`
            }
        })
    }
 function isNumberKey(txt, evt) {
      var charCode = (evt.which) ? evt.which : evt.keyCode;

        if (charCode == 8 && $(txt).val().length == 2 ){
                           return false;  
          }
          if ( charCode == 46 && $(txt).val().length == 2){
                           return false;  
          }
      if (charCode == 46) {
        //Check if the text already contains the . character
        if (txt.value.indexOf('.') === -1) {
          return true;
        } 
      } else {
        
          

        if (charCode > 31 &&
          (charCode < 48 || charCode > 57 && charCode <96))
          return false;
      }
      return true;
    }

    function verifyPM(payID) {
        console.log(payID);
        Swal.fire({
            title: "Verify Transaction Amounts",
            html: `
      <div class="mb-1">
          <p>Please confirm the values of the two ACH transactions that were sent to your account</p>
      <label class="form-label" for="itemquantity"> </label>      
      
  <div class="mb-1">
        <label class="form-label" for="itemquantity">Amount 1</label>
        <input type="text" class="form-control" id="amount01" value="0." onkeydown="return isNumberKey(this, event);">
      </div>
<div class="mb-1">
        <label class="form-label" for="itemquantity">Amount 2</label>
        <input type="text" class="form-control" id="amount02" value="0." onkeydown="return isNumberKey(this, event);">
      </div>
    </div>

  `,
            confirmButtonText: "Next",
            focusConfirm: false,
            preConfirm: () => {
                const amount1 = Swal.getPopup().querySelector("#amount01").value;
                const amount2 = Swal.getPopup().querySelector("#amount02").value;
                if (!amount1 || !amount2) {
                    Swal.showValidationMessage(
                        `Both fields are required`
                    );
                }
                return {
                    amount1: amount1,
                    amount2: amount2,
                };
            },
        }).then((result) => {
            console.log(result)
            if (result.isConfirmed) {
                window.location.href = `/verify_PM/${payID}/${result.value.amount1}/${result.value.amount2}`
            }

        });
/*var input = document.getElementById("amount01");
  input.focus();
  var len = input.value.length;
  input.setSelectionRange(len, len);
 input.addEventListener("click", function() {
    var len = input.value.length;
    input.setSelectionRange(len, len);
  });
  var input2 = document.getElementById("amount02");
  input2.focus();
  var len2 = input2.value.length;
  input2.setSelectionRange(len, len);
   input2.addEventListener("click", function() {
    var len2 = input2.value.length;
    input2.setSelectionRange(len, len);
  });*/
/* const input = document.getElementById('amount01');

const end = input.value.length;

// ✅ Move focus to END of input field
input.setSelectionRange(end, end);
input.focus();*/
  }
</script>